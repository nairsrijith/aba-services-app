<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pay Stub - {{ paystub.employee.firstname }} {{ paystub.employee.lastname }}</title>
    <style>
        @page { 
            size: A4; 
            margin: 12mm;
            @bottom-right {
                content: "Downloaded: " string(download_time);
                font-size: 8pt;
                color: #666;
                padding-right: 1cm;
            }
        }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            font-size: 11pt; 
            line-height: 1.4;
            margin: 0;
            padding: 0;
        }
        .pdf-container { 
            margin: 0 auto; 
            width: calc(100% - 16px);
            box-sizing: border-box;
            padding: 0;
        }
        .pdf-header { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            margin-bottom: 8px;
            padding: 0 8px;
            box-sizing: border-box;
        }
        .pdf-header img { 
            height: 48px; 
            margin-right: 10px; 
        }
        .pdf-header h2 { 
            margin: 0; 
            color: #0d6efd; 
        }
        .pdf-header .right {
            text-align: right;
        }
        .pdf-row { 
            display: flex; 
            width: 100%; 
            margin: 0;
            padding: 0 8px;
            gap: 16px;
            box-sizing: border-box;
        }
        .pdf-col-6 { 
            flex: 1;
            box-sizing: border-box;
        }
        .pdf-info-section { 
            background: #f8f9fa; 
            padding: 12px; 
            border-radius: 8px; 
            margin-bottom: 12px;
            box-sizing: border-box;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            border: 0.5px solid #e0e0e0;
            width: 100%;
        }
        .pdf-info-section h3 { 
            color: #0d6efd; 
            margin: 0 0 8px 0; 
            font-size: 13pt; 
        }
        .pdf-info-section p { 
            margin: 4px 0; 
        }
        .pdf-info-section.right { 
            text-align: right; 
        }
        .pdf-info-section.right p { 
            text-align: right; 
        }
        .pdf-info-section.right h3 { 
            text-align: right; 
        }
        .pdf-table-section {
            padding: 0 8px;
            box-sizing: border-box;
            width: 100%;
        }
        .pdf-table { 
            width: 100%; 
            border-collapse: separate; 
            border-spacing: 0; 
            margin-top: 0;
            font-size: 11px; 
            background: #fff; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.04); 
            border-radius: 8px; 
            overflow: hidden; 
            border: 0.5px solid #e0e0e0;
        }
        .pdf-table th { 
            background: #0d6efd; 
            color: #fff; 
            font-weight: 600; 
            padding: 10px 8px; 
            border: none; 
            text-align: left; 
        }
        .pdf-table td { 
            border: 0.5px solid #e0e0e0; 
            padding: 8px 8px; 
            text-align: left; 
            vertical-align: middle; 
        }
        .pdf-table tr:nth-child(even) td { 
            background: #f8f9fa; 
        }
        .pdf-table tr:nth-child(odd) td { 
            background: #fff; 
        }
        .pdf-table tr.total-row td { 
            background: #e9ecef; 
            font-weight: bold; 
            color: #0d6efd; 
        }
        .pdf-table th:first-child, 
        .pdf-table td:first-child { 
            border-top-left-radius: 8px; 
        }
        .pdf-table th:last-child, 
        .pdf-table td:last-child { 
            border-top-right-radius: 8px; 
        }
        .pdf-table td.text-end,
        .pdf-table th.text-end {
            text-align: right;
        }
        #download_time { 
            string-set: download_time content(); 
            visibility: hidden; 
        }
    </style>
</head>
<body>
    <div id="download_time">{{ download_time }}</div>
    <div class="pdf-container">
        <div class="pdf-header">
            <div>
                {% if logo_b64 %}
                    <img src="{{ logo_b64 }}" alt="LOGO">
                {% elif logo_url %}
                    <img src="{{ logo_url }}" alt="LOGO">
                {% elif logo_path %}
                    <img src="file://{{ logo_path }}" alt="LOGO">
                {% else %}
                    <img src="{{ url_for('static', filename='images/favicon.ico') }}" alt="LOGO">
                {% endif %}
            </div>
            <div class="right">
                <h2>{{ org_name }}</h2>
                <small>{{ org_address }}<br><small>Phone: {{ org_phone }} &emsp; Email: {{ org_email }}</small></small>
            </div>
        </div>
        <hr>

        <div class="pdf-row">
            <div class="pdf-col-6 pdf-info-section">
                <h3>Employee Information</h3>
                <p><strong>Name:</strong> {{ paystub.employee.firstname | title }} {{ paystub.employee.lastname | title }}</p>
                <p><strong>Position:</strong> {{ paystub.employee.position | title }}</p>
                {% if paystub.employee.rba_number %}
                <p><strong>RBA Number:</strong> {{ paystub.employee.rba_number }}</p>
                {% endif %}
            </div>
            <div class="pdf-col-6 pdf-info-section right">
                <h3>Pay Period</h3>
                <p><strong>From:</strong> {{ paystub.period_start.strftime('%Y-%m-%d') }}</p>
                <p><strong>To:</strong> {{ paystub.period_end.strftime('%Y-%m-%d') }}</p>
                <p><strong>Generated:</strong> {{ paystub.generated_date.strftime('%Y-%m-%d') }}</p>
            </div>
        </div>

        <div class="pdf-table-section">
            <table class="pdf-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Session Details</th>
                    <th class="text-end">Hours</th>
                    <th class="text-end">Rate</th>
                    <th class="text-end">Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for item in paystub.items %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td style="text-align: left;">
                        <strong>{{ item.intervention.intervention_type }}</strong> for <strong>{{ item.client.firstname[:3] | upper }}{{ item.client.lastname[:3] | upper }}</strong><br>
                        {{ item.intervention.date.strftime('%Y-%m-%d') }} ({{ item.intervention.start_time.strftime('%H:%M') }}-{{ item.intervention.end_time.strftime('%H:%M') }})
                    </td>
                    <td class="text-end">{{ "%.2f"|format(item.hours|float) }}</td>
                    <td class="text-end">{{ "%.2f"|format(item.rate|float) }}/hr</td>
                    <td class="text-end">{{ "%.2f"|format(item.amount|float) }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td colspan="2" style="text-align: right;">Total:</td>
                    <td class="text-end">{{ "%.2f"|format(paystub.total_hours|float) }}</td>
                    <td></td>
                    <td class="text-end">{{ "%.2f"|format(paystub.total_amount|float) }}</td>
                </tr>
            </tfoot>
        </table>

        {% if paystub.notes %}
        <div class="pdf-table-section">
            <div class="pdf-info-section">
                <h3>Notes</h3>
                <p>{{ paystub.notes }}</p>
            </div>
        </div>
        {% endif %}
    </div>
</body>
</html>